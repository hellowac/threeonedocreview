(window["webpackJsonp_ThreeIntelligence"]=window["webpackJsonp_ThreeIntelligence"]||[]).push([["chunk-4280c416"],{"03e3":function(e,t,a){},"0541":function(e,t,a){"use strict";var o=a("23e7"),i=a("1a2d");o({target:"Object",stat:!0},{hasOwn:i})},"143e":function(e,t,a){},"271a":function(e,t,a){"use strict";var o=a("cb2d"),i=a("e330"),r=a("577e"),s=a("d6d6"),l=URLSearchParams,n=l.prototype,c=i(n.getAll),d=i(n.has),u=new l("a=1");!u.has("a",2)&&u.has("a",void 0)||o(n,"has",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return d(this,e);var o=c(this,e);s(t,1);var i=r(a),l=0;while(l<o.length)if(o[l++]===i)return!0;return!1}),{enumerable:!0,unsafe:!0})},"2a32":function(e,t,a){},"46ab":function(e,t,a){"use strict";a("a4b1")},5494:function(e,t,a){"use strict";var o=a("83ab"),i=a("e330"),r=a("edd0"),s=URLSearchParams.prototype,l=i(s.forEach);o&&!("size"in s)&&r(s,"size",{get:function(){var e=0;return l(this,(function(){e++})),e},configurable:!0,enumerable:!0})},"6d79":function(e,t,a){"use strict";a("8344")},"7c48":function(e,t,a){"use strict";a("143e")},8344:function(e,t,a){},"88a7":function(e,t,a){"use strict";var o=a("cb2d"),i=a("e330"),r=a("577e"),s=a("d6d6"),l=URLSearchParams,n=l.prototype,c=i(n.append),d=i(n["delete"]),u=i(n.forEach),p=i([].push),f=new l("a=1&a=2&b=3");f["delete"]("a",1),f["delete"]("b",void 0),f+""!=="a=2"&&o(n,"delete",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return d(this,e);var o=[];u(this,(function(e,t){p(o,{key:t,value:e})})),s(t,1);var i,l=r(e),n=r(a),f=0,b=0,_=!1,h=o.length;while(f<h)i=o[f++],_||i.key===l?(_=!0,d(this,i.key)):b++;while(b<h)i=o[b++],i.key===l&&i.value===n||c(this,i.key,i.value)}),{enumerable:!0,unsafe:!0})},9990:function(e,t,a){"use strict";a("2a32")},"9f3a":function(e,t,a){},a4b1:function(e,t,a){},b48e:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("14d9"),a("13d5"),a("0541"),a("4360");function o(e){return Object.entries(e).reduce((e,[t,a])=>(null!==a&&""!==a&&(e[t]=a),e),{})}},d6d6:function(e,t,a){"use strict";var o=TypeError;e.exports=function(e,t){if(e<t)throw new o("Not enough arguments");return e}},e468:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"smart-review"},[t("div",{staticClass:"smart-review-input"},[t("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"请输入关键字","prefix-icon":"el-icon-search",clearable:""},on:{change:e.searchProjectByKey},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}})],1),t("SmartReviewFilters",{on:{createProject:e.createProject,review_status:e.queryByRevewStatus,proj_type:e.queryByProjType,start_date:e.queryByStartDate,end_date:e.queryByEndDate}}),t("SmartReviewTables",{attrs:{"table-data":e.tableData},on:{proj_detail:e.lookProjDetails,proj_audit:e.handleProjAudit}}),t("Pagination",{staticClass:"module-page",attrs:{limit:e.pageLimit,total:e.tableDataTotal},on:{"update:limit":function(t){e.pageLimit=t},"update:total":function(t){e.tableDataTotal=t},pagination:e.handlePagination}}),t("CreateNewProject",{ref:"createNewProject",on:{refresh_table:e.searchProject}}),t("DetailsInfo",{ref:"detailsInfo"}),t("SmartReviewAudit",{ref:"reviewAudit",on:{refresh:e.searchProject}})],1)},i=[],r=a("365c"),s=a("b48e"),l=a("bcbf"),n=function(){var e=this,t=e._self._c;return t("el-form",{attrs:{model:e.form,"label-width":"auto"}},[t("el-form-item",{attrs:{label:"类型:"}},[t("el-radio-group",{attrs:{"text-color":"#FFFFFF",fill:"rgba(5, 101, 98, 0.7)",size:"small"},on:{input:t=>{e.$emit("proj_type",t)}},model:{value:e.form.proj_type,callback:function(t){e.$set(e.form,"proj_type",t)},expression:"form.proj_type"}},[t("el-radio",{attrs:{label:""}},[e._v("全部")]),t("el-radio",{attrs:{label:"输电"}},[e._v("输电")]),t("el-radio",{attrs:{label:"变电"}},[e._v("变电")]),t("el-radio",{attrs:{label:"配电"}},[e._v("配电")])],1)],1),t("el-form-item",{attrs:{label:"时间:"}},[t("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",type:"date",placeholder:"开始日期","picker-options":e.starPickerOptions,size:"small"},on:{change:t=>{e.$emit("start_date",t)}},model:{value:e.form.start_date,callback:function(t){e.$set(e.form,"start_date",t)},expression:"form.start_date"}}),t("span",[e._v("  ~  ")]),t("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",type:"date",placeholder:"结束日期","picker-options":e.endPickerOptions,size:"small"},on:{change:t=>{e.$emit("end_date",t)}},model:{value:e.form.end_date,callback:function(t){e.$set(e.form,"end_date",t)},expression:"form.end_date"}})],1),t("el-form-item",{attrs:{label:"状态:"}},[t("el-radio-group",{attrs:{"text-color":"#FFFFFF",fill:"rgba(5, 101, 98, 0.7)",size:"small"},on:{input:t=>{e.$emit("review_status",t)}},model:{value:e.form.review_status,callback:function(t){e.$set(e.form,"review_status",t)},expression:"form.review_status"}},[t("el-radio",{attrs:{label:""}},[e._v("全部")]),t("el-radio",{attrs:{label:"文档解析中"}},[e._v("文档解析中")]),t("el-radio",{attrs:{label:"算法审核未通过"}},[e._v("算法审核未通过")]),t("el-radio",{attrs:{label:"算法审核通过"}},[e._v("算法审核通过")]),t("el-radio",{attrs:{label:"人工复核未通过"}},[e._v("人工复核未通过")]),t("el-radio",{attrs:{label:"人工复核通过"}},[e._v("人工复核通过")])],1)],1),t("el-form-item",{attrs:{label:"复核:"}},[t("el-alert",{staticStyle:{padding:"0"},attrs:{title:"只有【状态】处于【算法审核通过】的项目才可【复核】。",type:"info",closable:!1}})],1),t("el-form-item",{staticClass:"form-item-button-right"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("createProject")}}},[e._v("新建工程")])],1)],1)},c=[],d={name:"SmartReviewFilters",data(){return{form:{proj_type:"",start_date:"",end_date:"",review_status:""},starPickerOptions:{disabledDate(e){return e.getTime()>Date.now()||e.getTime()<Date.parse("2025-05-31")},shortcuts:[{text:"今天",onClick(e){e.$emit("pick",new Date)}},{text:"昨天",onClick(e){const t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick(e){const t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},endPickerOptions:{disabledDate(e){return e.getTime()>Date.now()||e.getTime()<Date.parse("2025-05-31")},shortcuts:[{text:"今天",onClick(e){e.$emit("pick",new Date)}},{text:"昨天",onClick(e){const t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick(e){const t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]}}},mounted(){},methods:{handlerType(e,t){this.queryForm[t]=e,console.log("queryForm:",this.queryForm)},disabledStartDate(e){return e.getTime()<new Date("2025-06-01")},disabledEndDate(e){return e.getTime()>Date.now()}}},u=d,p=(a("f93a"),a("2877")),f=Object(p["a"])(u,n,c,!1,null,"4a4b1eb7",null),b=f.exports,_=function(){var e=this,t=e._self._c;return t("el-table",{staticClass:"smart-review-tables",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":e.setHeaderClassName,"max-height":800}},[t("el-table-column",{attrs:{align:"center",width:"80",label:"类型"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",{staticClass:"tag-span",style:{"--colors":e.tagColors[a.type]}},[e._v(e._s(a.type))])]}}])}),t("el-table-column",{attrs:{prop:"name",label:"名称",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"提交次数",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",{staticClass:"submit-num"},[e._v(e._s(a.version)+"次")])]}}])}),t("el-table-column",{attrs:{prop:"create_date",label:"时间",align:"center"}}),t("el-table-column",{attrs:{prop:"review_status",label:"状态",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"处理进度",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("span",[e._v(e._s(a.review_percent+"%"))]),t("el-progress",{attrs:{percentage:a.review_percent,"show-text":!1,color:e.customColors}})]}}])}),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{size:"small",type:"text",disabled:"算法审核通过"!=a.review_status},on:{click:function(t){return e.$emit("proj_audit",a)}}},[e._v("复核")]),t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.$emit("proj_detail",a)}}},[e._v("详情")])]}}])})],1)},h=[],m={props:{tableData:{type:Array,required:!0,default:()=>[]}},data(){return{customColors:[{color:"rgba(5, 101, 98, 0.2)",percentage:20},{color:"rgba(5, 101, 98, 0.4)",percentage:40},{color:"rgba(5, 101, 98, 0.6)",percentage:60},{color:"rgba(5, 101, 98, 0.8)",percentage:80},{color:"rgba(5, 101, 98, 1)",percentage:100}],tagColors:{"输电":"rgba(22, 155, 213, 0.7)","变电":"rgba(70, 158, 134, 1)","配电":"rgba(5, 101, 98, 1)"}}},mounted(){},methods:{setHeaderClassName(){return{borderBottom:"none",backgroundColor:"rgba(5, 101, 98, 0.7)",color:"#fff"}}}},v=m,g=(a("7c48"),Object(p["a"])(v,_,h,!1,null,null,null)),w=g.exports,y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"create-new-project"},[t("el-dialog",{staticClass:"create-new-project",attrs:{visible:e.dialogFormVisible,title:"新建工程",width:"40%"},on:{"update:visible":function(t){e.dialogFormVisible=t}},scopedSlots:e._u([{key:"footer",fn:function(){return[t("div",{staticClass:"dialog-footer"},[t("el-button",{on:{click:e.cancel}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitFiles}},[e._v("确定")])],1)]},proxy:!0}])},[t("el-form",{attrs:{model:e.form,"label-suffix":":"}},[t("el-form-item",{attrs:{required:"",label:"工程名称","label-width":e.formLabelWidth}},[t("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":e.fetchProjNameSuggestions,placeholder:"请输入工程名称"},on:{select:e.handleProjNameSelect},model:{value:e.form.proj_name,callback:function(t){e.$set(e.form,"proj_name",t)},expression:"form.proj_name"}}),t("br"),t("small",[e._v("存在同一工程名称且专业一样时，将视为第n次提交。"),t("span",{staticStyle:{color:"red"}},[e._v("同时将重新发起审批流程。")])])],1),t("el-form-item",{attrs:{required:"",label:"专业类型","label-width":e.formLabelWidth}},[t("el-radio-group",{model:{value:e.form.proj_type,callback:function(t){e.$set(e.form,"proj_type",t)},expression:"form.proj_type"}},[t("el-radio",{attrs:{label:"输电",value:"输电",size:"large"}},[e._v("输电")]),t("el-radio",{attrs:{label:"变电",value:"变电",size:"large"}},[e._v("变电")]),t("el-radio",{attrs:{label:"配电",value:"配电",size:"large"}},[e._v("配电")])],1)],1),t("el-form-item",{attrs:{required:"",label:"三措文档","label-width":e.formLabelWidth}},[t("el-upload",{attrs:{action:"#","show-file-list":!1,"auto-upload":!1,"file-list":e.singleFileList,accept:".docx,.pdf","on-change":e.handleSingleFileChange},scopedSlots:e._u([{key:"trigger",fn:function(){return[t("el-button",{attrs:{type:"primary"}},[e._v("选择文件")]),e._v(" (支持单选) ")]},proxy:!0}])},[t("div",{attrs:{slot:"tip"},slot:"tip"},[e._v(" 支持docx/pdf文件格式 ")])])],1),t("el-form-item",{attrs:{label:"相关附件","label-width":e.formLabelWidth}},[t("el-upload",{attrs:{action:"#","show-file-list":!1,"auto-upload":!1,"file-list":e.multiFileList,"on-change":e.handleMultiFileChange,multiple:"",accept:"image/*,.docx,.pdf"},scopedSlots:e._u([{key:"trigger",fn:function(){return[t("el-button",{attrs:{type:"primary"}},[e._v("选择文件")]),e._v(" (支持多选) ")]},proxy:!0}])},[t("div",{attrs:{slot:"tip"},slot:"tip"},[e._v(" 支持图片、docx/pdf文件格式 ")])])],1),t("el-form-item",{attrs:{label:"为文件选择分类","label-width":e.formLabelWidth}},[e._l(e.singleFileList,(function(a,o){return t("div",{key:o,staticClass:"file-item"},[t("p",[e._v(e._s(a.name)+"   "),t("el-button",{attrs:{type:"primary",disabled:""}},[e._v(e._s(a.category))]),e._v("   "),t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.removeSingleFile(a.uid)}}},[e._v("删除")])],1)])})),e._l(e.multiFileList,(function(a){return t("div",{key:a.uid,staticClass:"file-item"},[t("p",[e._v(e._s(a.name)+"   "),t("el-select",{attrs:{placeholder:"选择文件分类",size:"small"},model:{value:a.category,callback:function(t){e.$set(a,"category",t)},expression:"file.category"}},[t("el-option",{key:1,attrs:{label:"可研材料",value:"可研材料"}}),t("el-option",{key:2,attrs:{label:"勘察单",value:"勘察单"}})],1),e._v("   "),t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.removeMultiFile(a.uid)}}},[e._v("删除")])],1)])}))],2)],1)],1)],1)},j=[],k={name:"CreateNewProject",data(){return{singleFileList:[],multiFileList:[],dialogFormVisible:!1,form:{proj_name:"",proj_type:"输电"},formLabelWidth:"140px"}},mounted(){},methods:{handleSingleFileChange(e,t){this.singleFileList=[{...e,category:"三措文档"}]},handleMultiFileChange(e,t){this.multiFileList=t.map(e=>({...e,category:"可研材料"}))},removeSingleFile(e){this.singleFileList=this.singleFileList.filter(t=>t.uid!==e)},removeMultiFile(e){this.multiFileList=this.multiFileList.filter(t=>t.uid!==e)},show(){this.dialogFormVisible=!0},submitFiles(){if(void 0===this.form.proj_name||""===this.form.proj_name)return void this.$message.error("请输入项目名称");if(0===this.singleFileList.length)return void this.$message.error("请先选择三措文件");const e=new FormData;e.append("proj_name",this.form.proj_name),e.append("proj_type",this.form.proj_type),e.append("threeone_file",this.singleFileList[0].raw);let t=0,a=0;if(0!==this.multiFileList.length){const o={};this.multiFileList.forEach(i=>{e.append("other_files",i.raw),o[i.name]=i.category,"可研材料"===i.category?t+=1:"勘察单"===i.category&&(a+=1)}),e.append("other_files_category",JSON.stringify(o))}t>1?this.$message.error("可研材料只支持1个文件！"):a>1?this.$message.error("勘察单材料只支持1个文件！"):Object(r["a"])("/documents/","post",e).then(e=>{this.$message.success("上传成功"),this.fileList=[],this.cancel(),this.$emit("refresh_table")}).catch(e=>{this.$message.error("上传失败"),console.error(e)})},cancel(){this.form.proj_name="",this.form.proj_type="输电",this.singleFileList=[],this.multiFileList=[],this.dialogFormVisible=!1},fetchProjNameSuggestions:Object(l["debounce"])((async function(e,t){if(e)try{const a={key:e},o=await Object(r["c"])("/projects/search",a),i=o.data.map(e=>({value:e}));t(i)}catch(a){console.error("搜索失败:",a),t([])}else t([])}),300),handleProjNameSelect(e){console.log("选中:",e)}}},C=k,x=(a("46ab"),Object(p["a"])(C,y,j,!1,null,null,null)),R=x.exports,F=function(){var e=this,t=e._self._c;return t("el-drawer",{staticClass:"details-info",attrs:{visible:e.drawer,"with-header":!1,size:"100%","before-close":e.beforeClose},on:{"update:visible":function(t){e.drawer=t},open:e.handleDrawerOpen}},[t("div",{staticClass:"details-info-item"},[t("div",{staticClass:"details-info-infomation-title"},[t("span",[e._v(e._s(e.projRow.name))]),t("el-button",{attrs:{size:"small",type:"danger",plain:""},on:{click:e.beforeClose}},[e._v("关闭")])],1),t("el-row",{staticClass:"details-info-infomation-row",attrs:{gutter:8}},[t("el-col",{attrs:{span:8}},[t("span",[e._v("类型：")]),t("span",[e._v(e._s(e.projRow.type)+"专业")])]),t("el-col",{attrs:{span:8}},[t("span",[e._v("提交时间：")]),t("span",[e._v(e._s(e.projRow.create_at))])]),t("el-col",{attrs:{span:8}},[t("span",[e._v("审核开始：")]),t("span",[e._v(e._s(e.projRow.review_begin_at))])])],1),t("el-row",{staticClass:"details-info-infomation-row",attrs:{gutter:8}},[t("el-col",{attrs:{span:8}},[t("span",[e._v("状态：")]),t("span",[e._v(e._s(e.projRow.review_status))])]),t("el-col",{attrs:{span:8}},[t("span",[e._v("提交次数：")]),t("span",[e._v(e._s(e.projRow.version)+"次")])]),t("el-col",{attrs:{span:8}},[t("span",[e._v("审核结束：")]),t("span",[e._v(e._s(e.projRow.review_done_at))])])],1),t("h3",[e._v("提交详情:")]),t("el-row",{staticClass:"details-info-infomation-row",attrs:{gutter:8}},[t("el-col",{attrs:{span:24}},[e._v(" 第 "),t("el-select",{attrs:{placeholder:"请选择提交次数",size:"mini"},on:{change:e.handleselectedVerionChange},model:{value:e.selectedVerion,callback:function(t){e.selectedVerion=t},expression:"selectedVerion"}},e._l(e.version_options,(function(e){return t("el-option",{key:e,attrs:{label:e.toString(),value:e}})})),1),e._v(" 次提交 ")],1)],1),t("h4",[e._v("文件列表:")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.fileList}},[t("el-table-column",{attrs:{prop:"file_name",label:"文件名"}}),t("el-table-column",{attrs:{prop:"file_size_human",label:"大小"}}),t("el-table-column",{attrs:{prop:"file_suffix",label:"类型"}}),t("el-table-column",{attrs:{prop:"file_category",label:"分类"}}),t("el-table-column",{attrs:{prop:"create_at",label:"上传时间"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",size:"small",loading:e.fileDownloading},on:{click:function(t){return e.downloadRawFile(a.row)}}},[e._v(" "+e._s(e.fileDownloading?"下载中...":"下载")+" ")])]}}])})],1),t("h4",[e._v("审核结果:")]),t("el-dropdown",{staticStyle:{"margin-bottom":"12px",cursor:"pointer",color:"#409EFF"},attrs:{trigger:"click"},on:{command:e.handleExportCommand}},[t("span",{staticClass:"el-dropdown-link"},[e._v(" 导出"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"txt"}},[e._v("txt")]),t("el-dropdown-item",{attrs:{command:"docx"}},[e._v("docx")])],1)],1),t("el-alert",{attrs:{type:"error",title:"目前仅支持核查文档中的文本+表格的内容！暂不支持文档中的图片，设计图等内容。",closable:!1}}),t("br"),t("el-tabs",{staticStyle:{height:"850px"},attrs:{"tab-position":"left"},on:{"tab-click":e.handleTabClick}},e._l(e.docContents,(function(a,o){return t("el-tab-pane",{key:o,attrs:{label:a.section}},[t("el-row",{staticStyle:{height:"850px"}},[t("el-col",{staticStyle:{"border-right":"1px solid rgba(5, 101, 98, 0.6)"},attrs:{span:12}},[t("p",{staticClass:"tcenter"},[e._v("内容")]),t("div",{staticClass:"scrollable-detail-content",staticStyle:{"padding-right":"10px"},domProps:{innerHTML:e._s(a.content)}})]),t("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:12}},[t("p",{staticClass:"tcenter"},[e._v("建议/检查点")]),t("div",{staticClass:"scrollable-detail-content"},[t("dl",[e._l(e.docContentReviews,(function(a,o){return[t("dt",{staticStyle:{"margin-top":"10px"}},[e._v("问题"+e._s(o+1))]),t("dd",[e._v(e._s(a.question)),t("br"),t("br"),e._v(" 建议: "+e._s(a.feedback)+" "),t("br"),a.source_text&&a.source_location?[t("hr"),e._v(" 原文: "+e._s(a.source_text)+" "),t("br"),e._v(" 位置: "+e._s(a.source_location)+" "),t("br")]:e._e(),a.reference_filename&&a.reference_content?[t("hr"),e._v(" 参考文件: "+e._s(a.reference_filename)+" "),t("br"),e._v(" 参考内容: "+e._s(a.reference_content)+" "+e._s(a.reference_location?"-":"")+" "+e._s(a.reference_location)),t("br")]:e._e()],2)]}))],2)])])],1)],1)})),1),t("p"),t("div",{staticClass:"details-info-infomation-tailer"},[t("span",[e._v(" ")]),t("el-button",{attrs:{size:"small",type:"danger",plain:""},on:{click:e.beforeClose}},[e._v("关闭")])],1)],1)])},S=[],P=(a("88a7"),a("271a"),a("5494"),{data(){return{drawer:!1,suggestionType:"overview",projRow:{name:"xxx项目三措",type:"输电",id:"81be7149-fd6d-4231-9d38-9a0823b7b6a2",version:1,review_status:"未审核",review_percent:25,review_begin_at:"2025-06-13 08:58:34",review_done_at:"2025-06-13 09:19:55",create_at:"2025-06-13 08:57:22",update_at:"2025-06-13 08:57:22",is_delete:!1,create_date:"2025-06-13"},innerVersion:void 0,fileList:[{id:"xxxxx-xxxx-xxx-xxxx",file_name:"用户手册.pdf",file_suffix:"docx",file_size_human:"2.5MB",file_category:"三措文档",create_at:"2023-10-01"}],docContents:[{section:"文档全部内容",content:"<p>全部内容</p>",suggestion:"",id:"6286cec2-6eb9-4f89-9d63-c941bc61103b",proj_id:"67c8da7b-3725-4081-90f9-f61768e03637",proj_version:1,doc_id:"95981df6-ff87-43f7-be27-b04866652f58"},{section:"文档头/封面",content:"<p>文档头/封面</p>",suggestion:"",id:"3e3e6cba-d083-4527-8c27-2ca05c0bb20a",proj_id:"67c8da7b-3725-4081-90f9-f61768e03637",proj_version:1,doc_id:"95981df6-ff87-43f7-be27-b04866652f58"},{section:"三、停电范围",content:"<p>停电范围</p>",suggestion:"",id:"795c405e-8c1b-4f48-9043-65020a616048",proj_id:"67c8da7b-3725-4081-90f9-f61768e03637",proj_version:1,doc_id:"95981df6-ff87-43f7-be27-b04866652f58"},{section:"十、现场作业示意图",content:"    十、现场作业示意图（附图） ",suggestion:"",id:"d93bb32d-7f3a-4f71-9294-7b0b68773f5d",proj_id:"67c8da7b-3725-4081-90f9-f61768e03637",proj_version:1,doc_id:"95981df6-ff87-43f7-be27-b04866652f58"}],docContentReviews:[{id:"b34a487d-6b66-4665-a7b6-fbc800bd3a52",proj_id:"4d1a9caf-d275-4b0a-ba91-2ab4b6d5deb3",proj_version:1,doc_id:"14aefdeb-d255-4d30-b2b1-03e0c100a73b",content_id:"05a4128d-9943-44f1-9566-7928e17e590f",section:"五、组织措施",question:"变压器检修记录中遗漏了绝缘测试数据。",question_tag:"数据缺失",feedback:"请补全变压器绝缘电阻测试记录。",feedback_tag:"补充测试数据",reference_filename:"《国家电网公司电力安全工作规程》",reference_content:"进入作业现场的所有人员应正确佩戴安全帽。",reference_location:"6 一般安全措施",source_text:"安全帽数量为23顶，作业人员共29人",source_location:"施工安全保证措施-(一)-安全工器具配置",ai_error:"",create_at:"2025-06-20 09:28:38",is_delete:!1},{id:"b8bcd1e4-bc16-4049-b72c-8747bbeb91d0",proj_id:"4d1a9caf-d275-4b0a-ba91-2ab4b6d5deb3",proj_version:1,doc_id:"14aefdeb-d255-4d30-b2b1-03e0c100a73b",content_id:"05a4128d-9943-44f1-9566-7928e17e590f",section:"五、组织措施",question:"倒闸操作票中未标明操作前验电要求。",question_tag:"操作规范不全",feedback:"请在操作票中添加验电确认无电压的操作项。",feedback_tag:"补充操作规范",reference_filename:"《国家电网公司电力安全工作规程》",reference_content:"进入作业现场的所有人员应正确佩戴安全帽。",reference_location:"6 一般安全措施",source_text:"安全帽数量为23顶，作业人员共29人",source_location:"施工安全保证措施-(一)-安全工器具配置",ai_error:"",create_at:"2025-06-20 09:28:38",is_delete:!1}],fileDownloading:!1}},computed:{version_options(){const e=Array.from({length:this.projRow.version},(e,t)=>t+1);return e.reverse()},selectedVerion:{get(){return this.innerVersion?this.innerVersion:this.projRow.version},set(e){this.innerVersion=e}}},mounted(){},methods:{show(e){this.projRow=e,this.drawer=!0,this.queryProjectFiels(),this.queryProjectReviews(),this.queryAllContentFeedback()},beforeClose(){this.docContents=[],this.fileList=[],this.innerVersion=void 0,this.drawer=!1},handleselectedVerionChange(e){console.log("[change]拉取",this.projRow.id,"的附件列表，版本号为: ",this.selectedVerion),this.queryProjectFiels(),this.queryProjectReviews()},queryProjectFiels(){console.log("拉取",this.projRow.id,"的附件列表，版本号为: ",this.selectedVerion),Object(r["c"])(`/projects/${this.projRow.id}/documents`,{version:this.selectedVerion}).then(e=>{console.log("拉取结果: ",e.data),this.fileList=e.data})},queryProjectReviews(){console.log("拉取",this.projRow.id,"的核查内容，版本号为: ",this.selectedVerion),Object(r["c"])(`/projects/${this.projRow.id}/reviews`,{version:this.selectedVerion}).then(e=>{console.log("拉取结果: ",e.data),this.docContents=e.data})},queryAllContentFeedback(){console.log("拉取",this.projRow.id,"的核查内容的所有反馈详细，版本号为: ",this.selectedVerion),Object(r["c"])(`/document/content/reviews/${this.projRow.id}/all`,{version:this.selectedVerion}).then(e=>{console.log("拉取内容审核详细结果: ",e.data),this.docContentReviews=e.data.data})},handleTabClick(e){if(console.log("拉取",this.projRow.id,"的核查内容详细，版本号为: ",this.selectedVerion,"Section为: ",e.label),"文档全部内容"===e.label)this.queryAllContentFeedback();else{const t=this.docContents.filter(t=>t.section===e.label)[0];console.log("当前的docConent 内容：",t),Object(r["c"])("/document/content/reviews/"+t.id).then(e=>{console.log("拉取内容审核详细结果: ",e.data),this.docContentReviews=e.data.data})}},downloadRawFile(e){console.log("下载源文件",e),this.fileDownloading=!0,Object(r["b"])(`/documents/${e.id}/download`).then(t=>{const a=new Blob([t.data],{type:t.headers["content-type"]}),o=window.URL.createObjectURL(a),i=document.createElement("a");i.href=o,i.download=e.file_name,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o),this.fileDownloading=!1})},handleExportCommand(e){console.log("处理导出command",e);const t={version:this.selectedVerion,type:e};Object(r["b"])(`/document/content/reviews/${this.projRow.id}/download`,t).then(e=>{const t=new Blob([e.data],{type:e.headers["content-type"]}),a=window.URL.createObjectURL(t),o=document.createElement("a");o.href=a;const i=e.headers["content-disposition"];o.download=this.getFileNameFromHeader(i),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a),this.fileDownloading=!1})},getFileNameFromHeader(e){let t="download.file";if(!e)return t;const a=e.match(/filename\*\=UTF-8''(.+)/i);if(a&&a[1])return t=decodeURIComponent(a[1]),t;const o=e.match(/filename\=\"?([^\";]+)\"?/i);return o&&o[1]?(t=decodeURIComponent(o[1]),t):t},handleDrawerOpen(){console.log("项目详情打开了, 当前版本号: "+this.selectedVerion,"项目数据:",this.projRow)}}}),D=P,L=(a("6d79"),Object(p["a"])(D,F,S,!1,null,null,null)),T=L.exports,$=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:e.projRow.name,visible:e.isShowDialog,center:"","with-header":!1,"before-close":e.beforeClose},on:{"update:visible":function(t){e.isShowDialog=t}}},[t("el-steps",{attrs:{active:4,"align-center":""}},[t("el-step",{attrs:{title:"步骤1",description:"上传三措文档和相关附件"}}),t("el-step",{attrs:{title:"步骤2",description:"解析三措文档，并保存至系统"}}),t("el-step",{attrs:{title:"步骤3",description:"AI智能体结合附件/标准规范等审核三措文档"}}),t("el-step",{attrs:{title:"步骤4",description:"算法审核结果"}}),t("el-step",{attrs:{title:"步骤5",description:"人工复核三措文档"}})],1),t("el-divider"),t("div",[t("el-radio-group",{model:{value:e.suggestionType,callback:function(t){e.suggestionType=t},expression:"suggestionType"}},[t("el-radio-button",{attrs:{label:"overview"}},[e._v("结果概述")]),t("el-radio-button",{attrs:{label:"detail"}},[e._v("结果详情"+e._s(`(${e.docContentReviewsCount})`))])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"overview"===e.suggestionType,expression:"suggestionType === 'overview'"}],staticClass:"scrollable-content",domProps:{innerHTML:e._s(e.projRow.review_suggestion)}}),t("div",{directives:[{name:"show",rawName:"v-show",value:"detail"===e.suggestionType,expression:"suggestionType === 'detail'"}],staticClass:"scrollable-content"},[t("dl",[e._l(e.docContentReviews,(function(a,o){return[t("dt",{staticStyle:{"margin-top":"10px"}},[e._v("问题"+e._s(o+1))]),t("dd",[e._v(e._s(a.question)+" "),t("hr"),e._v(" "+e._s(a.feedback)+" ")])]}))],2)])],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"danger"},on:{click:e.handleRejected}},[e._v("驳回")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleAccepted}},[e._v("通过")])],1)],1)},q=[],O={data(){return{isShowDialog:!1,suggestionType:"overview",projRow:{name:"xxx项目三措",type:"输电",id:"81be7149-fd6d-4231-9d38-9a0823b7b6a2",version:1,review_status:"未审核",review_percent:25,review_begin_at:"2025-06-13 08:58:34",review_done_at:"2025-06-13 09:19:55",review_suggestion:"<p>该文档部分大纲标题解析失败:</p><ol><li>一、工程概况及施工作业特点</li><li>二、施工作业计划工期、开(峻)工时间</li><li>四、作业主要内容</li><li>五、组织措施</li><li>六、技术措施</li><li>七、安全措施</li><li>八、应急处置措施</li><li>九、施工作业工艺标准及验收</li></ol><p>请按照<code>《国网海西供电公司施工“三措”计划管理实施细则（试行）.pdf》</code>文件中第十四条大纲内容编写文档。</p><p>标题大纲应遵循:</p><ol><li>一、工程概况及施工作业特点</li><li>二、施工作业计划工期、开(峻)工时间</li><li>三、停电范围</li><li>四、作业主要内容</li><li>五、组织措施</li><li>六、技术措施</li><li>七、安全措施</li><li>八、应急处置措施</li><li>九、施工作业工艺标准及验收</li><li>十、现场作业示意图</li></ol>",create_at:"2025-06-13 08:57:22",update_at:"2025-06-13 08:57:22",is_delete:!1,create_date:"2025-06-13"},docContentReviews:[{id:"b34a487d-6b66-4665-a7b6-fbc800bd3a52",proj_id:"4d1a9caf-d275-4b0a-ba91-2ab4b6d5deb3",proj_version:1,doc_id:"14aefdeb-d255-4d30-b2b1-03e0c100a73b",content_id:"05a4128d-9943-44f1-9566-7928e17e590f",section:"五、组织措施",question:"变压器检修记录中遗漏了绝缘测试数据。",question_tag:"数据缺失",feedback:"请补全变压器绝缘电阻测试记录。",feedback_tag:"补充测试数据",ai_error:"",create_at:"2025-06-20 09:28:38",is_delete:!1},{id:"b8bcd1e4-bc16-4049-b72c-8747bbeb91d0",proj_id:"4d1a9caf-d275-4b0a-ba91-2ab4b6d5deb3",proj_version:1,doc_id:"14aefdeb-d255-4d30-b2b1-03e0c100a73b",content_id:"05a4128d-9943-44f1-9566-7928e17e590f",section:"五、组织措施",question:"倒闸操作票中未标明操作前验电要求。",question_tag:"操作规范不全",feedback:"请在操作票中添加验电确认无电压的操作项。",feedback_tag:"补充操作规范",ai_error:"",create_at:"2025-06-20 09:28:38",is_delete:!1}],docContentReviewsCount:0}},computed:{},mounted(){},methods:{show(e){console.log("人工核查资产: ",e),this.projRow=e,this.isShowDialog=!0,this.queryAllContentFeedback()},beforeClose(){this.isShowDialog=!1},handleRejected(){console.log("驳回三措文件",this.projRow),this.$prompt("驳回理由",this.projRow.name,{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPattern:/^.{5,}$/,inputErrorMessage:"理由应不少于5个字！"}).then(({value:e})=>{console.log("驳回理由: "+e);const t={review_status:"人工复核未通过",audit_feedback:e};Object(r["d"])(`/projects/${this.projRow.id}/audit`,t).then(e=>{this.$message.warning("该三措文档已驳回!"),this.beforeClose(),this.$emit("refresh")})}).catch(()=>{this.$message.info("取消复核")})},queryAllContentFeedback(){console.log("拉取",this.projRow.id,"的核查内容的所有反馈详细，版本号为: ",this.projRow.version),Object(r["c"])(`/document/content/reviews/${this.projRow.id}/all`,{version:this.projRow.version}).then(e=>{console.log("拉取内容审核详细结果: ",e.data),this.docContentReviews=e.data.data,this.docContentReviewsCount=e.data.count})},handleAccepted(){console.log("通过三措文件",this.projRow);const e={review_status:"人工复核通过"};Object(r["d"])(`/projects/${this.projRow.id}/audit`,e).then(e=>{this.$message.success("该三措文档已通过!"),this.beforeClose(),this.$emit("refresh")})}}},V=O,z=(a("9990"),Object(p["a"])(V,$,q,!1,null,null,null)),A=z.exports,N={name:"SmartReview",components:{SmartReviewFilters:b,SmartReviewTables:w,CreateNewProject:R,DetailsInfo:T,SmartReviewAudit:A},data(){return{searchKey:"",proj_type:"",start_date:null,end_date:null,review_status:"",querySkip:0,queryLimit:10,tableData:[{name:"test1",type:"输电",id:"63b8ba01-0e90-4e36-a7ff-76fd8220045f",version:2,review_status:"未审核",review_percent:0,review_begin_at:null,review_done_at:null,create_at:"2025-06-12T16:44:08",update_at:"2025-06-12T16:44:08",is_delete:!1,create_date:"2025-06-12"},{name:"test12",type:"输电",id:"67c8da7b-3725-4081-90f9-f61768e03637",version:3,review_status:"未审核",review_percent:0,review_begin_at:null,review_done_at:null,create_at:"2025-06-12T16:45:31",update_at:"2025-06-12T16:45:31",is_delete:!1,create_date:"2025-06-12"}],tableDataTotal:0,pageLimit:10}},async mounted(){await this.searchProject()},methods:{createProject(){this.$refs.createNewProject.show()},lookProjDetails(e){console.log("查看项目详细:",e),this.$refs.detailsInfo.show(Object(l["cloneDeep"])(e))},handleProjAudit(e){console.log("审核项目:",e),this.$refs.reviewAudit.show(Object(l["cloneDeep"])(e))},async searchProject(){try{const e=Object(s["a"])({key:this.searchKey,proj_type:this.proj_type,start_date:this.start_date,end_date:this.end_date,review_status:this.review_status,skip:this.querySkip,limit:this.queryLimit}),t=await Object(r["c"])("/projects/",e);this.tableData=t.data.data,this.tableDataTotal=t.data.count}catch(e){console.error("搜索失败:",e),this.$message.error("Oops, 搜索失败: "+e)}},async searchProjectByKey(e){console.log("搜索的key:"+e),await this.searchProject()},async queryByRevewStatus(e){console.log("review_status:",e),this.review_status=e,await this.searchProject()},async queryByProjType(e){console.log("proj_type:",e),this.proj_type=e,await this.searchProject()},async queryByStartDate(e){console.log("start_date:",e),this.start_date=e,await this.searchProject()},async queryByEndDate(e){console.log("end_date:",e),this.end_date=e,await this.searchProject()},async handlePagination(e){console.log("处理分页:",e),this.querySkip=e.page>1?(e.page-1)*e.limit:0,this.queryLimit=e.limit,await this.searchProject()}}},B=N,M=(a("ebbc"),Object(p["a"])(B,o,i,!1,null,"29350ad4",null));t["default"]=M.exports},ebbc:function(e,t,a){"use strict";a("03e3")},f93a:function(e,t,a){"use strict";a("9f3a")}}]);